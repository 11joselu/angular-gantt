/*! angular-gantt 28-10-2014 */

var gantt=angular.module("gantt",[]);gantt.directive("gantt",["Gantt","dateFunctions","mouseOffset","debounce","keepScrollPos",function(a,b,c,d,e){return{restrict:"EA",replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/gantt.tmpl.html":b.templateUrl},scope:{sortMode:"=?",filterTask:"=?",filterTaskComparator:"=?",filterRow:"=?",filterRowComparator:"=?",viewScale:"=?",width:"=?",columnWidth:"=?",columnSubScale:"=?",allowTaskMoving:"=?",allowTaskResizing:"=?",allowTaskRowSwitching:"=?",allowRowSorting:"=?",allowLabelsResizing:"=?",fromDate:"=?",toDate:"=?",currentDateValue:"=?",currentDate:"=?",firstDayOfWeek:"=?",weekendDays:"=?",showWeekends:"=?",workHours:"=?",showNonWorkHours:"=?",autoExpand:"=?",taskOutOfRange:"=?",maxHeight:"=?",labelsWidth:"=?",showTooltips:"=?",headerShowMonth:"=?",headerShowWeek:"=?",headerShowDay:"=?",headerShowHour:"=?",headerFormatMonth:"=?",headerFormatWeek:"=?",headerFormatDay:"=?",headerFormatHour:"=?",tooltipDateFormat:"=?",timespans:"=?",data:"=?",loadTimespans:"&",loadData:"&",removeData:"&",clearData:"&",centerDate:"&",onColumnDateClicked:"&",onColumnDateDblClicked:"&",onColumnDataContextClicked:"&",onLabelsResized:"&",onLabelClicked:"&",onLabelDblClicked:"&",onLabelContextClicked:"&",onLabelHeaderClicked:"&",onLabelHeaderDblClicked:"&",onLabelHeaderContextClicked:"&",onGanttReady:"&",onTimespanAdded:"&",onTimespanUpdated:"&",onRowAdded:"&",onRowClicked:"&",onRowDblClicked:"&",onRowContextClicked:"&",onRowUpdated:"&",onRowMouseDown:"&",onScroll:"&",onTaskClicked:"&",onTaskDblClicked:"&",onTaskContextClicked:"&",onTaskUpdated:"&",onTaskMoveBegin:"&",onTaskMoveEnd:"&",onTaskResizeBegin:"&",onTaskResizeEnd:"&"},controller:["$scope","$element",function(f){void 0===f.sortMode&&(f.sortMode="name"),void 0===f.viewScale&&(f.viewScale="day"),void 0===f.width&&(f.width=0),void 0===f.columnWidth&&(f.columnWidth=2),void 0===f.columnSubScale&&(f.columnSubScale=4),void 0===f.allowTaskMoving&&(f.allowTaskMoving=!0),void 0===f.allowTaskResizing&&(f.allowTaskResizing=!0),void 0===f.allowTaskRowSwitching&&(f.allowTaskRowSwitching=!0),void 0===f.allowRowSorting&&(f.allowRowSorting=!0),void 0===f.allowLabelsResizing&&(f.allowLabelsResizing=!0),void 0===f.currentDateValue&&(f.currentDateValue=new Date),void 0===f.currentDate&&(f.currentDate="line"),void 0===f.firstDayOfWeek&&(f.firstDayOfWeek=1),void 0===f.weekendDays&&(f.weekendDays=[0,6]),void 0===f.showWeekends&&(f.showWeekends=!0),void 0===f.workHours&&(f.workHours=[8,9,10,11,12,13,14,15,16]),void 0===f.showNonWorkHours&&(f.showNonWorkHours=!0),void 0===f.maxHeight&&(f.maxHeight=0),void 0===f.autoExpand&&(f.autoExpand="none"),void 0===f.taskOutOfRange&&(f.taskOutOfRange="expand"),void 0===f.labelsWidth&&(f.labelsWidth=0),void 0===f.showTooltips&&(f.showTooltips=!0),void 0===f.headerShowMonth&&(f.headerShowMonth=!0),void 0===f.headerShowWeek&&(f.headerShowWeek=!0),void 0===f.headerShowDay&&(f.headerShowDay=!0),void 0===f.headerShowHour&&(f.headerShowHour=!0),f.gantt=new a(f),f.$watch("sortMode",function(a,b){angular.equals(a,b)||f.sortRows()}),f.$watch("timespans",function(a,b){angular.equals(a,b)||(f.removeAllTimespans(),f.setTimespans(a))}),f.$watch("data",function(a,b){angular.equals(a,b)||(f.removeAllData(),f.setData(a))}),f.getPxToEmFactor=function(){return f.ganttScroll.children()[0].offsetWidth/f.gantt.width},f.swapRows=function(a,b){f.gantt.swapRows(a,b),f.raiseRowUpdatedEvent(a,!0),f.raiseRowUpdatedEvent(b,!0),"custom"!==f.sortMode?f.sortMode="custom":f.sortRows()},f.sortRows=function(){f.gantt.sortRows(f.sortMode)},f.scrollTo=function(a){f.ganttScroll[0].scrollLeft=a,f.ganttScroll.triggerHandler("scroll")},f.scrollLeft=function(a){f.ganttScroll[0].scrollLeft-=a,f.ganttScroll.triggerHandler("scroll")},f.scrollRight=function(a){f.ganttScroll[0].scrollLeft+=a,f.ganttScroll.triggerHandler("scroll")},f.scrollToDate=function(a){var b=f.gantt.getColumnByDate(a);if(void 0!==b){var c=(b.left+b.width/2)*f.getPxToEmFactor();f.ganttScroll[0].scrollLeft=c-f.ganttScroll[0].offsetWidth/2}},f.autoExpandColumns=e(f,function(a,c,d){if("both"===f.autoExpand||f.autoExpand===!0||f.autoExpand===d){var e,g,h=1,i=31;"left"===d?(e="hour"===f.viewScale?b.addDays(c,-h,!0):b.addDays(c,-i,!0),g=c):(e=c,g="hour"===f.viewScale?b.addDays(c,h,!0):b.addDays(c,i,!0)),f.gantt.requestDateRange(e,g)}}),f.raiseColumnDateClickedEvent=function(a,b){f.onColumnDateClicked({event:{evt:a,column:b}})},f.raiseColumnDateDblClickedEvent=function(a,b){f.onColumnDateDblClicked({event:{evt:a,column:b}})},f.raiseColumnDateContextMenuEvent=function(a,b){f.onColumnDataContextClicked({event:{evt:a,column:b}})},f.raiseLabelsResized=function(a){f.onLabelsResized({event:{width:a}})},f.raiseLabelClickedEvent=function(a,b){f.onLabelClicked({event:{evt:a,row:b,userTriggered:!0}})},f.raiseLabelDblClickedEvent=function(a,b){f.onLabelDblClicked({event:{evt:a,row:b,userTriggered:!0}})},f.raiseLabelContextMenuEvent=function(a,b){f.onLabelContextClicked({event:{evt:a,row:b,userTriggered:!0}})},f.raiseLabelHeaderClickedEvent=function(a){f.onLabelHeaderClicked({event:{evt:a,userTriggered:!0}})},f.raiseLabelHeaderDblClickedEvent=function(a){f.onLabelHeaderDblClicked({event:{evt:a,userTriggered:!0}})},f.raiseLabelHeaderContextMenuEvent=function(a){f.onLabelHeaderContextClicked({event:{evt:a,userTriggered:!0}})},f.raiseRowAddedEvent=function(a,b){f.onRowAdded({event:{row:a,userTriggered:b}})},f.raiseDOMRowClickedEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.raiseRowClickedEvent(a,b,g,h)},f.raiseRowClickedEvent=function(a,b,c,d){f.onRowClicked({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}})},f.raiseDOMRowDblClickedEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.raiseRowDblClickedEvent(a,b,g,h)},f.raiseRowDblClickedEvent=function(a,b,c,d){f.onRowDblClicked({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}})},f.raiseDOMRowMouseDownEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.raiseRowMouseDownEvent(a,b,g,h)},f.raiseRowMouseDownEvent=function(a,b,c,d){f.onRowMouseDown({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}})},f.raiseDOMRowClickedEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.raiseRowClickedEvent(a,b,g,h)},f.raiseDOMRowContextMenuEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.raiseRowContextMenuEvent(a,b,g,h)},f.raiseRowContextMenuEvent=function(a,b,c,d){f.onRowContextClicked({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}})},f.raiseRowUpdatedEvent=function(a,b){f.onRowUpdated({event:{row:a,userTriggered:b}})},f.raiseScrollEvent=d(function(){if(void 0!==f.gantt.getDateRange()){var a,b,c=f.ganttScroll[0];0===c.scrollLeft?(a="left",b=f.gantt.getDateRange().from):c.offsetWidth+c.scrollLeft>=c.scrollWidth&&(a="right",b=f.gantt.getDateRange().to),void 0!==b&&(f.autoExpandColumns(c,b,a),f.onScroll({event:{date:b,direction:a,userTriggered:!0}}))}},5),f.raiseTaskUpdatedEvent=function(a,b){f.onTaskUpdated({event:{task:a,userTriggered:b}})},f.raiseTaskMoveStartEvent=function(a){f.onTaskMoveBegin({event:{task:a,userTriggered:!0}})},f.raiseTaskMoveEndEvent=function(a){f.onTaskMoveEnd({event:{task:a,userTriggered:!0}})},f.raiseTaskResizeStartEvent=function(a){f.onTaskResizeBegin({event:{task:a,userTriggered:!0}})},f.raiseTaskResizeEndEvent=function(a){f.onTaskResizeEnd({event:{task:a,userTriggered:!0}})},f.raiseTaskClickedEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e+b.left),h=f.gantt.getDateByPosition(e+b.left);f.onTaskClicked({event:{evt:a,task:b,column:g,date:h,userTriggered:!0}})},f.raiseTaskDblClickedEvent=function(a,b){f.onTaskDblClicked({event:{evt:a,task:b,userTriggered:!0}})},f.raiseTaskContextMenuEvent=function(a,b){f.onTaskContextClicked({event:{evt:a,task:b,userTriggered:!0}})},f.setData=e(f,function(a){f.gantt.addData(a,function(a){f.raiseRowAddedEvent(a,!1)},function(a){f.raiseRowUpdatedEvent(a,!1)}),f.sortRows()}),f.removeData({fn:function(a){f.gantt.removeData(a,function(a){f.raiseRowUpdatedEvent(a,!1)}),f.sortRows()}}),f.removeAllData=function(){f.gantt.removeAllRows(),f.gantt.requestDateRange(f.fromDate,f.toDate)},f.removeAllTimespans=function(){f.gantt.removeAllTimespans(),f.gantt.requestDateRange(f.fromDate,f.toDate)},f.setTimespans=e(f,function(a){f.gantt.addTimespans(a,function(a){f.raiseTimespanAddedEvent(a,!1)},function(a){f.raiseTimespanUpdatedEvent(a,!1)}),f.sortRows()}),f.raiseTimespanAddedEvent=function(a,b){f.onTimespanAdded({event:{timespan:a,userTriggered:b}})},f.raiseTimespanUpdatedEvent=function(a,b){f.onTimespanUpdated({event:{timespan:a,userTriggered:b}})},f.loadData({fn:f.setData}),f.loadTimespans({fn:f.setTimespans}),f.clearData({fn:f.removeAllData}),f.centerDate({fn:f.scrollToDate}),f.onGanttReady()}]}}]),gantt.factory("Column",["dateFunctions",function(a){var b=function(a,b,c){return Math.round(b/a.width*c/(b/a.subScale))*(b/a.subScale)},c=function(a,b,c,d){var e;return e=b-a.date>0&&!a.containsDate(b)?1:Math.round(d/c*a.subScale)/a.subScale,Math.round(10*(a.left+a.width*e))/10},d=function(a,b,c,e){var f=this;f.date=a,f.left=b,f.width=c,f.subScale=e,f.getEndDate=function(){return f.getDateByPosition(f.width)},f.clone=function(){return new d(f.date,f.left,f.width,f.subScale)},f.equals=function(a){return f.date===a.date}},e=function(e,f,g,h){var i=new d(e,f,g,h);return i.daysInMonth=a.getDaysInMonth(i.date),i.clone=function(){return new d(i.date,i.left,i.width,i.subScale)},i.containsDate=function(a){return a.getMonth()===i.date.getMonth()},i.getDateByPosition=function(c){0>c&&(c=0),c>i.width&&(c=i.width);var d=a.clone(i.date);return d.setDate(1+b(i,i.daysInMonth,c)),d},i.getPositionByDate=function(a){return c(i,a,i.daysInMonth,a.getDate())},i},f=function(e,f,g,h,i){var j=new d(e,f,g,h);j.week=a.getWeek(e),j.firstDayOfWeek=i,j.daysInWeek=7,j.clone=function(){var a=new d(j.date,j.left,j.width,j.subScale);return a.week=j.week,a},j.containsDate=function(a){return m(a)===m(j.date)};var k=function(a){return(j.daysInWeek-j.firstDayOfWeek+a)%j.daysInWeek},l=function(a){return(j.firstDayOfWeek+a)%j.daysInWeek},m=function(b){return 1===j.firstDayOfWeek?a.getWeek(b):void a.getWeek(a.addDays(b,1-j.firstDayOfWeek,!0))};return j.getDateByPosition=function(c){0>c&&(c=0),c>j.width&&(c=j.width);var d=a.clone(j.date),e=Math.round(b(j,j.daysInWeek,c)),f=7!==e&&0>e?-1:1;return a.setToDayOfWeek(d,7!==e?l(e):l(e)+7,!1,f),d},j.getPositionByDate=function(a){return c(j,a,j.daysInWeek,k(a.getDay()))},j},g=function(e,f,g,h,i,j,k,l,m){var n=new d(e,f,g,h);n.isWeekend=i,n.showNonWorkHours=m;var o=0,p=24;return 9==arguments.length&&!m&&l.length>1&&(o=l[0],p=l[l.length-1]+1),n.clone=function(){var a=new d(n.date,n.left,n.width,n.subScale);return a.isWeekend=n.isWeekend,a},n.containsDate=function(a){return a.getDate()===n.date.getDate()},n.getDateByPosition=function(c,d){0>c&&(c=0),c>n.width&&(c=n.width);var e=a.clone(n.date),f=o+b(n,p-o,c);return 2==arguments.length&&(f===p&&d?(e=a.addDays(e,j),f=o):f!==o||d||(e=a.addDays(e,-k),f=p)),e.setHours(f),e},n.getPositionByDate=function(b){if(a.setTimeZero(b,!0)>a.setTimeZero(n.date,!0))return n.left+n.width;if(a.setTimeZero(b,!0)<a.setTimeZero(n.date,!0))return n.left;var d=p-o,e=b.getHours()-o;return 0>e?n.left:e>d?n.left+n.width:c(n,b,d,e)},n},h=function(e,f,g,h,i,j,k,l){var m=new d(e,f,g,h);return m.isWeekend=i,m.isWorkHour=j,m.clone=function(){var a=new d(m.date,m.left,m.width,m.subScale);return a.isWeekend=m.isWeekend,a.isWorkHour=m.isWorkHour,a},m.containsDate=function(a){return a.getDate()===m.date.getDate()&&a.getHours()===m.date.getHours()},m.getDateByPosition=function(c,d){0>c&&(c=0),c>m.width&&(c=m.width);var e=a.clone(m.date),f=b(m,60,c);return 2==arguments.length&&(60===f&&d?(e=a.addHours(e,k),f=0):0!==f||d||(e=a.addHours(e,-l),f=60)),e.setMinutes(f),e},m.getPositionByDate=function(b){return a.setTimeZero(b,!0)>a.setTimeZero(m.date,!0)?m.left+m.width:c(m,b,60,b.getMinutes())},m};return{Hour:h,Day:g,Week:f,Month:e}}]),gantt.factory("ColumnGenerator",["Column","dateFunctions",function(a,b){var c=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c]]=!0;return b},d=function(a,b){return a[b]===!0},e=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c]]=!0;return b},f=function(a,b){return a[b]===!0},g=function(a,b,c){if(a&&b&&c){var d=Math.abs(a/b);angular.forEach(c,function(a){a.left=d*a.left,a.width=d*a.width})}},h=function(h,i,j,k,l,m,n){this.generate=function(r,s,t,u,v){if(!s&&!t)throw"to or maximumWidth must be defined";var w=!1;r=b.setTimeZero(r,!0),s&&(w=o(s),s=b.setTimeZero(s,!0));for(var x=b.clone(r),y=[],z=0,A=e(m),B=c(k);;){if(t&&Math.abs(z)>t+24*i)break;v&&(z-=24*i);for(var C=d(B,x.getDay()),D=0;24>D;D++){var E=new Date(x.getFullYear(),x.getMonth(),x.getDate(),D,0,0),F=f(A,D);if((C&&l||!C)&&(!F&&n||F)){var G=1,H=1;n||(G=p(A,E.getHours()),H=q(A,E.getHours())),y.push(new a.Hour(E,u?z+u:z,i,j,C,F,G,H)),z+=i}}if(v&&(z-=24*i),s)if(v){if(w&&s>x||!w&&s>=x)break}else if(w&&x>s||!w&&x>=s)break;x=b.addDays(x,v?-1:1)}return g(h,z,y),y},this.columnExpandNecessary=function(a,c,d,e){return o(e)&&(e=b.addHours(e,-1,!0)),a>d||c<b.setTimeZero(e,!0)};var o=function(a){return b.isTimeZero(a)},p=function(a,b){for(var c=1;25>c;c++){var d=(b+c)%24;if(f(a,d))return c}return 1},q=function(a,b){for(var c=1;25>c;c++){var d=((b-c)%24+24)%24;if(f(a,d))return c}return 1}},i=function(e,f,h,i,j,k,l){this.generate=function(p,q,r,s,t){if(!q&&!r)throw"to or maximumWidth must be defined";var u=!1;p=b.setTimeZero(p,!0),q&&(u=m(q),q=b.setTimeZero(q,!0));for(var v=b.clone(p),w=[],x=0,y=c(i);;){if(r&&Math.abs(x)>r+f)break;var z=d(y,v.getDay());if(z&&j||!z){var A=1,B=1;j||(A=n(y,v.getDay()),B=o(y,v.getDay())),w.push(new a.Day(b.clone(v),s?x+s:x,f,h,z,A,B,k,l)),t?x-=f:x+=f}if(q)if(t){if(u&&q>v||!u&&q>=v)break}else if(u&&v>q||!u&&v>=q)break;v=b.addDays(v,t?-1:1)}return t&&(m(p)&&w.shift(),w.reverse()),g(e,x,w),w},this.columnExpandNecessary=function(a,c,d,e){return m(e)&&(e=b.addDays(e,-1,!0)),a>d||c<b.setTimeZero(e,!0)};var m=function(a){return b.isTimeZero(a)},n=function(a,b){for(var c=1;8>c;c++){var e=(b+c)%7;if(!d(a,e))return c}return 1},o=function(a,b){for(var c=1;8>c;c++){var e=((b-c)%7+7)%7;if(!d(a,e))return c}return 1}},j=function(c,d,e,f){this.generate=function(i,j,k,l,m){if(!j&&!k)throw"to or maximumWidth must be defined";var n=!1;i=b.setToDayOfWeek(b.setTimeZero(i,!0),f,!1),j&&(n=h(j),j=b.setToDayOfWeek(b.setTimeZero(j,!0),f,!1));for(var o=b.clone(i),p=[],q=0;;){if(k&&Math.abs(q)>k+d)break;if(p.push(new a.Week(b.clone(o),l?q+l:q,d,e,f)),m?q-=d:q+=d,j)if(m){if(n&&j>o||!n&&j>=o)break}else if(n&&o>j||!n&&o>=j)break;o=b.addWeeks(o,m?-1:1)}return m&&(h(i)&&p.shift(),p.reverse()),g(c,q,p),p},this.columnExpandNecessary=function(a,c,d,e){return h(e)&&(e=b.addWeeks(e,-1,!0)),a>d||c<b.setToDayOfWeek(b.setTimeZero(e,!0),f)};var h=function(a){return a.getDay()===f&&b.isTimeZero(a)}},k=function(c,d,e){this.generate=function(h,i,j,k,l){if(!i&&!j)throw"to or maximumWidth must be defined";var m=!1;h=b.setToFirstDayOfMonth(b.setTimeZero(h,!0),!1),i&&(m=f(i),i=b.setToFirstDayOfMonth(b.setTimeZero(i,!0),!1));for(var n=b.clone(h),o=[],p=0;;){if(j&&Math.abs(p)>j+d)break;if(o.push(new a.Month(b.clone(n),k?p+k:p,d,e)),l?p-=d:p+=d,i)if(l){if(m&&i>n||!m&&i>=n)break}else if(m&&n>i||!m&&n>=i)break;n=b.addMonths(n,l?-1:1)}return l&&(f(h)&&o.shift(),o.reverse()),g(c,p,o),o},this.columnExpandNecessary=function(a,c,d,e){return f(e)&&(e=b.addMonths(e,-1,!0)),a>d||c<b.setToFirstDayOfMonth(b.setTimeZero(e,!0))};var f=function(a){return 1===a.getDate()&&b.isTimeZero(a)}};return{HourGenerator:h,DayGenerator:i,WeekGenerator:j,MonthGenerator:k}}]),gantt.factory("Gantt",["$filter","Row","Timespan","ColumnGenerator","HeaderGenerator","dateFunctions","binarySearch",function(a,b,c,d,e,f,g){var h=function(h){var i=this;i.rowsMap={},i.rows=[],i.visibleRows=[],i.timespansMap={},i.timespans=[],i.columns=[],i.visibleColumns=[],i.headers={},i.previousColumns=[],i.nextColumns=[],i.width=0;var j;h.$watch("viewScale+width+labelsWidth+columnWidth+columnSubScale+firstDayOfWeek+weekendDays+showWeekends+workHours+showNonWorkHours",function(a,b){angular.equals(a,b)||(i.requestDateRange(h.fromDate,h.toDate),i.buildGenerators(),i.reGenerateColumns())}),h.$watch("fromDate+toDate+autoExpand+taskOutOfRange",function(a,b){angular.equals(a,b)||i.requestDateRange(h.fromDate,h.toDate)}),h.$watch("currentDate+currentDateValue",function(a,b){angular.equals(a,b)||i.setCurrentDate(h.currentDateValue)}),i.buildGenerators=function(){switch(h.viewScale){case"hour":i.columnGenerator=new d.HourGenerator(h.width,h.columnWidth,h.columnSubScale,h.weekendDays,h.showWeekends,h.workHours,h.showNonWorkHours);break;case"day":i.columnGenerator=new d.DayGenerator(h.width,h.columnWidth,h.columnSubScale,h.weekendDays,h.showWeekends,h.workHours,h.showNonWorkHours);break;case"week":i.columnGenerator=new d.WeekGenerator(h.width,h.columnWidth,h.columnSubScale,h.firstDayOfWeek);break;case"month":i.columnGenerator=new d.MonthGenerator(h.width,h.columnWidth,h.columnSubScale);break;default:throw"Unsupported view scale: "+h.viewScale}i.headerGenerator=new e.instance(h)},i.buildGenerators(),i.requestDateRange=function(a,b){a&&b&&("expand"==h.taskOutOfRange?(l(a,b),m()):(k(a,b),n(j.from,j.to)))};var k=function(a,b){a=f.clone(a),b=f.clone(b),void 0===j?(j={},j.from=a,j.to=b):(j.from=a,j.to=b)},l=function(a,b){if(a=a?f.clone(a):a,b=b?f.clone(b):b,!j&&a&&b)j={},j.from=a,j.to=b;else if(j){a&&a<j.from&&(j.from=a);var c=j.from;angular.forEach(i.rows,function(a){angular.forEach(a.tasks,function(a){(null===c||c>a.from)&&(c=a.from)})}),c&&c<j.from&&(j.from=c),b&&b>j.to&&(j.to=b);var d=null;angular.forEach(i.rows,function(a){angular.forEach(a.tasks,function(a){(null===d||d<a.to)&&(d=a.to)})}),d&&d>j.to&&(j.to=d)}},m=function(){if(void 0===j)return!1;if(0===i.columns.length)return n(j.from,j.to);if(i.columnGenerator.columnExpandNecessary(i.getFirstColumn().date,i.getLastColumn().date,j.from,j.to)){var a=i.getFirstColumn().date>j.from?j.from:i.getFirstColumn().date,b=i.getLastColumn().date<j.to?j.to:i.getLastColumn().date;return n(a,b)}};i.requestDateRange(h.fromDate,h.toDate),i.setCurrentDate=function(a){i._currentDate=a,angular.forEach(i.columns,function(b){a>=b.date&&a<b.getEndDate()?b.currentDate=a:delete b.currentDate})},i.setCurrentDate(h.currentDateValue);var n=function(a,b){i.columns=i.columnGenerator.generate(a,b),i.headers=i.headerGenerator.generate(i.columns),i._currentDate&&i.setCurrentDate(i._currentDate),i.previousColumns=[],i.nextColumns=[];var c=i.getLastColumn();return i.width=void 0!==c?c.left+c.width:0,i.updateTasksPosAndSize(),i.updateTimespansPosAndSize(),k(a,b),h.fromDate=a,h.toDate=b,!0},o=function(a){if(0>a){var b=i.getFirstColumn(),c=b.date,d=i.getFirstColumn(!0);return(!d||d.left>a)&&(i.previousColumns=i.columnGenerator.generate(c,null,-a,0,!0)),!0}if(a>i.width){var e=i.getLastColumn(),f=e.getDateByPosition(e.width),g=i.getLastColumn(!0);return(!g||g.left+g.width<a)&&(i.nextColumns=i.columnGenerator.generate(f,null,a-i.width,i.width,!1)),!0}return!1},p=function(a){var b=i.getFirstColumn(),c=null;b&&(c=b.date);var d=i.getLastColumn(),e=null;if(d&&(e=d.getDateByPosition(d.width)),c&&c>a){var f=i.getFirstColumn(!0);return(!f||f.date>a)&&(i.previousColumns=i.columnGenerator.generate(c,a,null,0,!0)),!0}if(e&&a>e){var g=i.getLastColumn(!0);return(!g||g>e)&&(i.nextColumns=i.columnGenerator.generate(e,a,null,i.width,!1)),!0}return!1};i.reGenerateColumns=function(){return i.columns=[],i.previousColumns=[],i.nextColumns=[],void 0!==j?(m(),!0):!1},i.updateTasksPosAndSize=function(){for(var a=0,b=i.rows.length;b>a;a++)for(var c=0,d=i.rows[a].tasks.length;d>c;c++)i.rows[a].tasks[c].updatePosAndSize()},i.updateTimespansPosAndSize=function(){for(var a=0,b=i.timespans.length;b>a;a++)i.timespans[a].updatePosAndSize()},i.getLastColumn=function(a){var b=i.columns;return a&&(b=i.nextColumns),b&&b.length>0?b[b.length-1]:void 0},i.getFirstColumn=function(a){var b=i.columns;return a&&(b=i.previousColumns),b&&b.length>0?b[0]:void 0},i.getColumnByDate=function(a){p(a);var b=i.previousColumns.concat(i.columns,i.nextColumns),c=g.get(b,a,function(a){return a.date});return void 0!==c[0]?c[0]:c[1]},i.getColumnByPosition=function(a){o(a);var b=i.previousColumns.concat(i.columns,i.nextColumns);return g.get(b,a,function(a){return a.left})[0]},i.getDateByPosition=function(a,b){var c=i.getColumnByPosition(a);return void 0!==c?void 0!==b?c.getDateByPosition(a-c.left,b):c.getDateByPosition(a-c.left):void 0},i.getPositionByDate=function(a){if(!a)return void 0;var b=i.getColumnByDate(a);return void 0!==b?b.getPositionByDate(a):void 0},i.getDateRange=function(){return void 0===j?void 0:{from:f.clone(j.from),to:f.clone(j.to)}},i.getTasksDateRange=function(){if(0===i.rows.length)return void 0;for(var a,b,c=0,d=i.rows.length;d>c;c++){var e=i.rows[c];(void 0===a||e.minFromDate<a)&&(a=e.minFromDate),(void 0===b||e.maxToDate>b)&&(b=e.maxToDate)}return{from:a,to:b}},i.getActiveHeadersCount=function(){var a,b=0;for(a in i.headers)i.headers.hasOwnProperty(a)&&b++;return b},i.addData=function(a,b,c){for(var d=0,e=a.length;e>d;d++){var f=a[d],g=q(f),h=i.rowsMap[f.id];g===!0&&void 0!==c?c(h):void 0!==b&&b(h)}m()};var q=function(a){var c,d=!1;if(a.id in i.rowsMap)c=i.rowsMap[a.id],c.copy(a),d=!0;else{var e=a.order;void 0===e&&(e=i.highestRowOrder),e>=i.highestRowOrder&&(i.highestRowOrder=e+1),c=new b(a.id,i,a.description,e,a.data),i.rowsMap[a.id]=c,i.rows.push(c)}if(void 0!==a.tasks&&a.tasks.length>0)for(var f=0,g=a.tasks.length;g>f;f++){var j=c.addTask(a.tasks[f]);"expand"===h.taskOutOfRange&&(l(j.from,j.to),m()),j.updatePosAndSize()}return d};i.removeData=function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(void 0!==e.tasks&&e.tasks.length>0){if(e.id in i.rowsMap){for(var f=i.rowsMap[e.id],g=0,h=e.tasks.length;h>g;g++)f.removeTask(e.tasks[g].id);void 0!==b&&b(f)}}else r(e.id)}};var r=function(a){if(a in i.rowsMap){delete i.rowsMap[a];for(var b=0,c=i.rows.length;c>b;b++){var d=i.rows[b];if(d.id===a)return i.rows.splice(b,1),d}}return void 0};i.removeAllRows=function(){i.rowsMap={},i.rows=[],i.highestRowOrder=0,i.columns=[],j=void 0},i.removeAllTimespans=function(){i.timespansMap={},i.timespans=[]},i.swapRows=function(a,b){var c=a.order;a.order=b.order,b.order=c},i.sortRows=function(b){var c=!1;b=b,"-"==b.charAt(0)&&(c=!0,b=b.substr(1));var d=a("orderBy");i.rows="name"===b?d(i.rows,"description.toLowerCase()",c):"date"===b?d(i.rows,"minFromDate",c):"custom"===b?d(i.rows,"order",c):d(i.rows,b,c)},i.addTimespans=function(a,b,c){for(var d=0,e=a.length;e>d;d++){var f=a[d],g=s(f),h=i.timespansMap[f.id];g===!0&&void 0!==c?c(h):void 0!==b&&b(h),l(h.from,h.to),h.updatePosAndSize()}m()};var s=function(a){var b,d=!1;return a.id in i.timespansMap?(b=i.timespansMap[a.id],b.copy(a),d=!0):(b=new c(a.id,i,a.subject,a.color,a.classes,a.priority,a.from,a.to,a.data),i.timespansMap[a.id]=b,i.timespans.push(b)),d}};return h}]),gantt.factory("HeaderGenerator",["Column","dateFunctions",function(a,b){var c=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getHours()!==h.date.getHours()?(d=new a.Hour(b.clone(h.date),h.left,h.width,h.isWeekend,h.isWorkHour),e.push(d)):d.width+=h.width}return e},d=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getDay()!==h.date.getDay()?(d=new a.Day(b.clone(h.date),h.left,h.width,h.isWeekend,h.daysToNextWorkingDay,h.daysToPrevWorkingDay),e.push(d)):d.width+=h.width}return e},e=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||b.getWeek(c[f-1].date)!==b.getWeek(h.date)?(d=new a.Week(b.clone(h.date),h.left,h.width,b.getWeek(h.date)),e.push(d)):d.width+=h.width}return e},f=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getMonth()!==h.date.getMonth()?(d=new a.Month(b.clone(h.date),h.left,h.width),e.push(d)):d.width+=h.width}return e};return{instance:function(a){this.generate=function(b){var g={};return a.headerShowHour&&["hour"].indexOf(a.viewScale)>-1&&(g.hour=c(b)),a.headerShowDay&&["hour","day"].indexOf(a.viewScale)>-1&&(g.day=d(b)),a.headerShowWeek&&["week"].indexOf(a.viewScale)>-1&&(g.week=e(b)),a.headerShowMonth&&["week","month"].indexOf(a.viewScale)>-1&&(g.month=f(b)),g}}}}]),gantt.factory("Row",["Task","dateFunctions",function(a,b){var c=function(d,e,f,g,h){var i=this;i.id=d,i.gantt=e,i.description=f,i.order=g,i.tasksMap={},i.tasks=[],i.visibleTasks=[],i.data=h,i.addTask=function(b){var c;return b.id in i.tasksMap?(c=i.tasksMap[b.id],c.copy(b)):(c=new a(b.id,i,b.subject,b.color,b.classes,b.priority,b.from,b.to,b.data,b.est,b.lct),i.tasksMap[b.id]=c,i.tasks.push(c)),i.sortTasks(),i.setMinMaxDateByTask(c),c},i.moveTaskToRow=function(a){a.row.removeTask(a.id),i.tasksMap[a.id]=a,i.tasks.push(a),i.setTasksMinMaxDate(),a.row=i,a.updatePosAndSize()},i.removeTask=function(a){if(a in i.tasksMap){delete i.tasksMap[a];for(var b=0,c=i.tasks.length;c>b;b++){var d=i.tasks[b];if(d.id===a)return i.tasks.splice(b,1),(i.minFromDate-d.from===0||i.maxToDate-d.to===0)&&i.setTasksMinMaxDate(),d}}},i.setTasksMinMaxDate=function(){i.minFromDate=void 0,i.maxToDate=void 0;for(var a=0,b=i.tasks.length;b>a;a++)i.setMinMaxDateByTask(i.tasks[a])},i.setMinMaxDateByTask=function(a){void 0===i.minFromDate?i.minFromDate=b.clone(a.from):a.from<i.minFromDate&&(i.minFromDate=b.clone(a.from)),void 0===i.maxToDate?i.maxToDate=b.clone(a.to):a.to>i.maxToDate&&(i.maxToDate=b.clone(a.to))},i.sortTasks=function(){i.tasks.sort(function(a,b){return a.left-b.left})},i.copy=function(a){i.description=a.description,i.data=a.data,void 0!==a.order&&(i.order=a.order)},i.clone=function(){for(var a=new c(i.id,i.gantt,i.description,i.order,i.data),b=0,d=i.tasks.length;d>b;b++)a.addTask(i.tasks[b].clone());return a}};return c}]),gantt.factory("Task",["dateFunctions",function(a){var b=function(c,d,e,f,g,h,i,j,k,l,m){var n=this;n.id=c,n.gantt=d.gantt,n.row=d,n.subject=e,n.color=f,n.classes=g,n.priority=h,n.from=a.clone(i),n.to=a.clone(j),n.truncatedLeft=!1,n.truncatedRight=!1,n.data=k,void 0!==l&&void 0!==m&&(n.est=a.clone(l),n.lct=a.clone(m)),n.checkIfMilestone=function(){n.isMilestone=n.from-n.to===0},n.checkIfMilestone(),n.hasBounds=function(){return void 0!==n.bounds},n.updatePosAndSize=function(){n.modelLeft=n.gantt.getPositionByDate(n.from),n.modelWidth=n.gantt.getPositionByDate(n.to)-n.modelLeft,n.outOfRange=n.modelLeft+n.modelWidth<0||n.modelLeft>n.gantt.width,n.left=Math.min(Math.max(n.modelLeft,0),n.gantt.width),n.modelLeft<0?(n.truncatedLeft=!0,n.modelWidth+n.modelLeft>n.gantt.width?(n.truncatedRight=!0,n.width=n.gantt.width):(n.truncatedRight=!1,n.width=n.modelWidth+n.modelLeft)):n.modelWidth+n.modelLeft>n.gantt.width?(n.truncatedRight=!0,n.truncatedLeft=!1,n.width=n.gantt.width-n.modelLeft):(n.truncatedLeft=!1,n.truncatedRight=!1,n.width=n.modelWidth),void 0!==n.est&&void 0!==n.lct&&(n.bounds={},n.bounds.left=n.gantt.getPositionByDate(n.est),n.bounds.width=n.gantt.getPositionByDate(n.lct)-n.bounds.left)},n.setFrom=function(a){n.from=n.gantt.getDateByPosition(a,!0),n.row.setMinMaxDateByTask(n),n.updatePosAndSize(),n.checkIfMilestone()},n.setTo=function(a){n.to=n.gantt.getDateByPosition(a,!1),n.row.setMinMaxDateByTask(n),n.updatePosAndSize(),n.checkIfMilestone()},n.moveTo=function(a){n.from=n.gantt.getDateByPosition(a,!0);var b=n.gantt.getPositionByDate(n.from);n.to=n.gantt.getDateByPosition(b+n.modelWidth,!1),n.row.setMinMaxDateByTask(n),n.updatePosAndSize()},n.copy=function(b){n.subject=b.subject,n.color=b.color,n.classes=b.classes,n.priority=b.priority,n.from=a.clone(b.from),n.to=a.clone(b.to),n.est=void 0!==b.est?a.clone(b.est):void 0,n.lct=void 0!==b.lct?a.clone(b.lct):void 0,n.data=b.data,n.isMilestone=b.isMilestone},n.clone=function(){return new b(n.id,n.row,n.subject,n.color,n.classes,n.priority,n.from,n.to,n.data,n.est,n.lct)}};return b}]),gantt.factory("Timespan",["dateFunctions",function(a){var b=function(c,d,e,f,g,h,i,j,k,l,m){var n=this;n.id=c,n.gantt=d,n.subject=e,n.color=f,n.classes=g,n.priority=h,n.from=a.clone(i),n.to=a.clone(j),n.data=k,void 0!==l&&void 0!==m&&(n.est=a.clone(l),n.lct=a.clone(m)),n.hasBounds=function(){return void 0!==n.bounds},n.updatePosAndSize=function(){n.left=n.gantt.getPositionByDate(n.from),n.width=n.gantt.getPositionByDate(n.to)-n.left,void 0!==n.est&&void 0!==n.lct&&(n.bounds={},n.bounds.left=n.gantt.getPositionByDate(n.est),n.bounds.width=n.gantt.getPositionByDate(n.lct)-n.bounds.left)},n.setFrom=function(a){n.from=n.gantt.getDateByPosition(a,!0),n.updatePosAndSize()},n.setTo=function(a){n.to=n.gantt.getDateByPosition(a,!1),n.updatePosAndSize()},n.moveTo=function(a){n.from=n.gantt.getDateByPosition(a,!0),n.to=n.gantt.getDateByPosition(a+n.width,!1),n.updatePosAndSize()},n.copy=function(b){n.subject=b.subject,n.color=b.color,n.classes=b.classes,n.priority=b.priority,n.from=a.clone(b.from),n.to=a.clone(b.to),n.est=void 0!==b.est?a.clone(b.est):void 0,n.lct=void 0!==b.lct?a.clone(b.lct):void 0,n.data=b.data},n.clone=function(){return new b(n.id,n.gantt,n.subject,n.color,n.classes,n.priority,n.from,n.to,n.data,n.est,n.lct)}};return b}]),gantt.service("binarySearch",[function(){return{getIndicesOnly:function(a,b,c){for(var d=-1,e=a.length;e-d>1;){var f=Math.floor((d+e)/2);c(a[f])<=b?d=f:e=f}return void 0!==a[d]&&c(a[d])===b&&(e=d),[d,e]},get:function(a,b,c){var d=this.getIndicesOnly(a,b,c);return[a[d[0]],a[d[1]]]}}}]),gantt.service("dateFunctions",[function(){return{isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isString:function(a){return"string"==typeof a||"object"==typeof a&&a.constructor===String},clone:function(a){return new Date(this.isString(a)?Date.parse(a):this.isNumber(a)?a:a.getTime())},setTimeZero:function(a,b){var c=b===!0?this.clone(a):a;return c.setHours(0),c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0),c},setTimeComponent:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,b)},setToFirstDayOfMonth:function(a,b){var c=b===!0?this.clone(a):a;return c.setDate(1),c},setToDayOfWeek:function(a,b,c,d){var e=c===!0?this.clone(a):a;if(e.getDay()===b)return e;d=d||-1;var f=(b-e.getDay()+7*(d||1))%7;return this.addDays(e,0===f?f+=7*(d||1):f)},addMonths:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(1),d.setMonth(d.getMonth()+b),d},addWeeks:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+7*b),d},addDays:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+b),d},addHours:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setHours(d.getHours()+b),d},addMinutes:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMinutes(d.getMinutes()+b),d},addSeconds:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setSeconds(d.getSeconds()+b),d},addMilliseconds:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMilliseconds(d.getMilliseconds()+b),d},isTimeZero:function(a){return 0===a.getHours()&&0===a.getMinutes()&&0===a.getSeconds()&&0===a.getMilliseconds()},getDaysInMonth:function(a){return new Date(a.getYear(),a.getMonth()+1,0).getDate()},getWeek:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),2>=c?(e=b-1,f=(e/4|0)-(e/100|0)+(e/400|0),g=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),m=f-g,i=0,j=d-1+31*(c-1)):(e=b,f=(e/4|0)-(e/100|0)+(e/400|0),g=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),m=f-g,i=m+1,j=d+(153*(c-3)+2)/5+58+m),k=(e+f)%7,h=(j+k-i)%7,l=j+3-h|0,n=0>l?53-((k-m)/5|0):l>364+m?1:(l/7|0)+1,b=c=d=null,n}}}]),gantt.filter("ganttColumnLimit",["binarySearch",function(a){return function(b,c,d){var e=function(a){return a.left},f=a.getIndicesOnly(b,c,e)[0],g=a.getIndicesOnly(b,c+d,e)[1];
return b.slice(f,g)}}]),gantt.directive("ganttLimitUpdater",["$timeout",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){var d=c[0],e=function(){b.scroll_start=d.scrollLeft/b.getPxToEmFactor(),b.scroll_width=d.offsetWidth/b.getPxToEmFactor()};c.bind("scroll",function(){b.$apply(function(){e()})}),b.$watch("gantt.width",function(){a(function(){e()},20,!0)})}]}}]),gantt.filter("ganttRowLimit",["$filter",function(a){return function(b,c){return c.filterRow&&(b=a("filter")(b,c.filterRow,c.filterRowComparator)),b}}]),gantt.filter("ganttTaskLimit",["$filter",function(a){return function(b,c,d,e){for(var f=[],g=0,h=b.length;h>g;g++){var i=b[g];i.isMoving?f.push(i):i.to>e.$parent.gantt.getFirstColumn().date&&i.from<e.$parent.gantt.getLastColumn().getEndDate()&&(i.left>=c&&i.left<=c+d||i.left+i.width>=c&&i.left+i.width<=c+d||i.left<c&&i.left+i.width>c+d)&&f.push(i)}return e.filterTask&&(f=a("filter")(f,e.filterTask,e.filterTaskComparator)),f}}]),gantt.directive("ganttLabelsResize",["$document","debounce","mouseOffset",function(a,b,c){return{restrict:"A",scope:{enabled:"=ganttLabelsResize",width:"=ganttLabelsResizeWidth",minWidth:"=ganttLabelsResizeMinWidth",onResized:"&onLabelsResized"},controller:["$scope","$element",function(d,e){var f,g=5,h="ew-resize";e.bind("mousedown",function(a){d.enabled&&j(a)&&(k(a),a.preventDefault())}),e.bind("mousemove",function(a){d.enabled&&(j(a)?e.css("cursor",h):e.css("cursor",""))});var i=function(a){d.$apply(function(){0===d.width&&(d.width=e[0].offsetWidth),d.width+=a-f,d.width<d.minWidth&&(d.width=d.minWidth)}),f=a},j=function(a){var b=c.getOffset(a).x;return b>e[0].offsetWidth-g},k=function(c){f=c.screenX,angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:h});var d=b(function(a){i(a.screenX)},5);angular.element(a[0].body).bind("mousemove",d),angular.element(a[0].body).one("mouseup",function(){angular.element(a[0].body).unbind("mousemove",d),l()})},l=function(){e.css("cursor",""),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),d.onResized({width:d.width})}}]}}]),gantt.directive("ganttRightClick",["$parse",function(a){return{restrict:"A",compile:function(b,c){var d=a(c.ganttRightClick);return function(a,b){b.on("contextmenu",function(b){a.$apply(function(){d(a,{$event:b})})})}}}}]),gantt.directive("ganttHorizontalScrollReceiver",function(){return{restrict:"A",require:"^ganttScrollManager",controller:["$scope","$element",function(a,b){a.scrollManager.horizontal.push(b[0])}]}}),gantt.directive("ganttScrollManager",function(){return{restrict:"A",require:"^gantt",controller:["$scope",function(a){a.scrollManager={horizontal:[],vertical:[]}}]}}),gantt.directive("ganttScrollSender",["$timeout",function(a){return{restrict:"A",require:"^ganttScrollManager",controller:["$scope","$element",function(b,c){b.ganttScroll=c,b.ganttScroll.bind("scroll",b.raiseScrollEvent);var d=c[0],e=function(){var a,c;for(a=0,c=b.scrollManager.vertical.length;c>a;a++){var e=b.scrollManager.vertical[a];e.style.top!==-d.scrollTop&&(e.style.top=-d.scrollTop+"px")}for(a=0,c=b.scrollManager.horizontal.length;c>a;a++){var f=b.scrollManager.horizontal[a];f.style.left!==-d.scrollLeft&&(f.style.left=-d.scrollLeft+"px")}};c.bind("scroll",e),b.$watch("gantt.width",function(b){0===b&&a(function(){e()},0,!0)})}]}}]),gantt.directive("ganttVerticalScrollReceiver",function(){return{restrict:"A",require:"^ganttScrollManager",controller:["$scope","$element",function(a,b){a.scrollManager.vertical.push(b[0])}]}}),gantt.service("sortManager",[function(){return{startRow:void 0}}]),gantt.directive("ganttSortable",["$document","sortManager",function(a,b){return{restrict:"E",template:"<div ng-transclude></div>",replace:!0,transclude:!0,scope:{row:"=ngModel",swap:"&",active:"=?"},controller:["$scope","$element",function(c,d){d.bind("mousedown",function(){if(c.active===!0){f();var b=function(){c.$apply(function(){angular.element(a[0].body).unbind("mouseup",b),g()})};angular.element(a[0].body).bind("mouseup",b)}}),d.bind("mousemove",function(d){if(e()){var f=angular.element(a[0].elementFromPoint(d.clientX,d.clientY)),g=f.controller("ngModel").$modelValue;c.$apply(function(){c.swap({a:g,b:b.startRow})})}});var e=function(){return void 0!==b.startRow&&!angular.equals(c.row,b.startRow)},f=function(){b.startRow=c.row,d.css("cursor","move"),angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"no-drop"})},g=function(){b.startRow=void 0,d.css("cursor","pointer"),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:"auto"})}}]}}]),gantt.directive("ganttBounds",[function(){return{restrict:"E",templateUrl:function(a,b){return void 0===b.templateUrl?"default.bounds.tmpl.html":b.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(a){var b={};a.task.hasBounds()||(a.visible=!1),a.getCss=function(){return a.task.hasBounds()&&(b.width=a.task.bounds.width+"em",b.left=a.task.isMilestone===!0||0===a.task.width?a.task.bounds.left-(a.task.left-.3)+"em":a.task.bounds.left-a.task.left+"em"),b},a.getClass=function(){return void 0===a.task.est||void 0===a.task.lct?"gantt-task-bounds-in":a.task.est>a.task.from?"gantt-task-bounds-out":a.task.lct<a.task.to?"gantt-task-bounds-out":"gantt-task-bounds-in"},a.$watch("task.isMouseOver",function(){a.task.hasBounds()&&!a.task.isMoving&&(a.visible=!(void 0===a.task.isMouseOver||a.task.isMouseOver===!1))}),a.$watch("task.isMoving",function(b){a.task.hasBounds()&&(a.visible=b===!0)})}]}}]),gantt.directive("ganttTask",["$window","$document","$timeout","smartEvent","debounce","dateFunctions","mouseOffset","mouseButton",function(a,b,c,d,e,f,g,h){return{restrict:"E",templateUrl:function(a,b){return void 0===b.templateUrl?"default.task.tmpl.html":b.templateUrl},replace:!0,controller:["$scope","$element",function(f,i){var j,k,l,m=5,n=3,o=15,p=5,q=angular.element(a),r=i.parent(),s=r.parent(),t=s.parent().parent(),u=!1;i.bind("mousedown",function(a){f.$apply(function(){var b=A(a);if(""!==b&&1===h.getButton(a)){var c=g.getOffsetForElement(s[0],a).x;C(b,c)}})}),i.bind("click",function(a){f.$apply(function(){u||f.raiseTaskClickedEvent(a,f.task),a.stopPropagation()})}),i.bind("dblclick",function(a){f.$apply(function(){u||f.raiseTaskDblClickedEvent(a,f.task),a.stopPropagation()})}),i.bind("contextmenu",function(a){f.$apply(function(){u||f.raiseTaskContextMenuEvent(a,f.task),a.stopPropagation()})}),i.bind("mousemove",e(function(a){var b=A(a);""===b||!f.task.isMoving&&"M"===b?i.css("cursor",""):i.css("cursor",B(b)),f.task.mouseX=a.clientX},5)),i.bind("mouseenter",function(a){f.$apply(function(){f.task.mouseX=a.clientX,f.task.isMouseOver=!0})}),i.bind("mouseleave",function(){f.$apply(function(){f.task.isMouseOver=!1})});var v=function(a,b){f.task.isMoving!==!1&&(w(a,b),x(a,b))},w=function(a,b){f.task.mouseOffsetX=b.x;var c=b.x/f.getPxToEmFactor();if("M"===a){if(f.allowTaskRowSwitching){var d=z(b.y);void 0!==d&&f.task.row.id!==d.id&&d.moveTaskToRow(f.task)}if(f.allowTaskMoving){var e=c-j;"truncate"!==f.taskOutOfRange&&(0>e?e=0:e+f.task.width>=f.gantt.width&&(e=f.gantt.width-f.task.width)),f.task.moveTo(e)}}else"E"===a?("truncate"!==f.taskOutOfRange&&(c<f.task.left?c=f.task.left:c>f.gantt.width&&(c=f.gantt.width)),f.task.setTo(c)):("truncate"!==f.taskOutOfRange&&(c>f.task.left+f.task.width?c=f.task.left+f.task.width:0>c&&(c=0)),f.task.setFrom(c));u=!0},x=function(a,b){var d=t[0].scrollLeft,e=!1;if(b.x<k)b.x<=d+p&&(b.x-=o,e=!0,f.scrollLeft(o));else{var g=t[0].offsetWidth,h=d+g;b.x>=h-p&&(b.x+=o,e=!0,f.scrollRight(o))}e&&(l=c(function(){v(a,b)},100,!0))},y=function(){void 0!==l&&(c.cancel(l),l=void 0)},z=function(a){if(a>=r[0].offsetTop&&a<=r[0].offsetTop+r[0].offsetHeight)return f.task.row;var b=s[0].offsetHeight/f.task.row.gantt.visibleRows.length,c=Math.floor(a/b);return f.task.row.gantt.visibleRows[c]},A=function(a){var b=g.getOffset(a).x,c=0;return f.allowTaskResizing&&(c=i[0].offsetWidth<10?n:m),f.allowTaskResizing&&b>i[0].offsetWidth-c?"E":f.allowTaskResizing&&c>b?"W":(f.allowTaskMoving||f.allowTaskRowSwitching)&&b>=c&&b<=i[0].offsetWidth-c?"M":""},B=function(a){switch(a){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},C=function(a,h){f.task.isMoving||("M"===a?f.raiseTaskMoveStartEvent(f.task):f.raiseTaskResizeStartEvent(f.task)),u=!1,f.task.moveMode=a,f.task.isMoving=!0,k=h;var l=k/f.getPxToEmFactor();j=l-f.task.modelLeft;var m=e(function(b){c(function(){var c=g.getOffsetForElement(s[0],b);y(),v(a,c)})},5);d(f,q,"mousemove",m).bind(),d(f,q,"mouseup",function(){f.$apply(function(){q.unbind("mousemove",m),D()})}).bindOnce(),i.css("cursor",B(a)),angular.element(b[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:B(a)})},D=function(){f.task.isMoving=!1,y(),i.css("cursor",""),angular.element(b[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),"M"===f.task.moveMode?f.raiseTaskMoveEndEvent(f.task):f.raiseTaskResizeEndEvent(f.task),f.task.modeMode=null,u===!0&&(f.task.row.sortTasks(),f.raiseTaskUpdatedEvent(f.task,!0))};f.task.isCreating?(delete f.task.isCreating,C("E",f.task.mouseOffsetX)):f.task.isMoving&&C("M",f.task.mouseOffsetX)}]}}]),gantt.directive("ganttTooltip",["$timeout","$document","debounce","smartEvent",function(a,b,c,d){return{restrict:"E",templateUrl:function(a,b){return void 0===b.templateUrl?"default.tooltip.tmpl.html":b.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(e,f){var g=angular.element(b[0].body),h=f.parent();e.visible=!1,e.css={},e.$watch("task.isMouseOver",function(a){a===!0?k(e.task.mouseX):a===!1&&e.task.isMoving===!1&&m()});var i=d(e,g,"mousemove",c(function(a){e.visible===!0?l(a.clientX):k(a.clientX)},1));e.$watch("task.isMoving",function(a){a===!0?i.bind():a===!1&&(i.unbind(),m())});var j=function(){var a=b[0];return a.documentElement.clientWidth||a.documentElement.getElementById("body")[0].clientWidth},k=function(b){e.visible=!0,a(function(){l(b),e.css.top=h[0].getBoundingClientRect().top+"px",e.css.marginTop=-f[0].offsetHeight-8+"px",e.css.opacity=1},1,!0)},l=function(a){f.removeClass("gantt-task-infoArrow"),f.removeClass("gantt-task-infoArrowR"),a+f[0].offsetWidth>j()?(e.css.left=a+20-f[0].offsetWidth+"px",f.addClass("gantt-task-infoArrowR")):(e.css.left=a-20+"px",f.addClass("gantt-task-infoArrow"))},m=function(){e.css.opacity=0,e.visible=!1}}]}}]),gantt.filter("ganttDate",["$filter",function(a){var b=a("date");return"function"==typeof moment?function(a,c){return a=moment(a),moment.isMoment(a)?(c=c.replace("yyyy","YYYY"),c=c.replace("yy","YY"),c=c.replace("dd","DD"),c=c.replace("EEEE","dddd"),a.format(c)):b(a,c)}:b}]),gantt.factory("debounce",["$timeout",function(a){function b(b,c){var d=0;return function(){var e=this,f=arguments;d++;var g=function(a){return function(){return a===d?b.apply(e,f):void 0}}(d);return a(g,c,!0)}}return b}]),gantt.factory("keepScrollPos",["$timeout",function(a){function b(b,c){return function(){if(b.ganttScroll){var d=b.ganttScroll[0],e=d.scrollLeft,f=b.gantt.getFirstColumn(),g=b.getPxToEmFactor();c.apply(this,arguments),f=void 0===f?0:b.gantt.getColumnByDate(f.date).left*g,d.scrollLeft=f+e,d.scrollLeft!=f+e&&a(function(){d.scrollLeft=f+e},0,!1)}else c.apply(this,arguments)}}return b}]),gantt.service("mouseButton",[function(){return{getButton:function(a){return a=a||window.event,a.which?a.which:a.button<2?1:4==a.button?2:3}}}]),gantt.service("mouseOffset",[function(){return{getOffset:function(a){return a.offsetX&&a.offsetY?{x:a.offsetX,y:a.offsetY}:a.layerX&&a.layerY?{x:a.layerX,y:a.layerY}:this.getOffsetForElement(a.target,a)},getOffsetForElement:function(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}}}]),gantt.factory("smartEvent",[function(){function a(a,b,c,d){return a.$on("$destroy",function(){b.unbind(c,d)}),{bindOnce:function(){b.one(c,d)},bind:function(){b.bind(c,d)},unbind:function(){b.unbind(c,d)}}}return a}]),gantt.filter("sprintf",function(){function a(a){var b=[].slice.call(arguments,1),c=0;return a.replace(/%s/g,function(){return b[c++]})}return function(b){return a(b,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}});
//# sourceMappingURL=angular-gantt.min.js.map